<html>

<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />

<style>

.todo
  {
    color: gray;
  }

h1
  {
    font-size: 40pt;
  }

h2
  {
    font-size: 30pt;
  }

table
  {
    border-collapse: collapse;
  }

.normal_table td
  {
    border: 1px solid black;
    padding: 5px;
  }

</style>
</head>

<body>
<h1> flow_chart language specification </h1>

<span class="author"> Miloslav Číž, 2014 </span>

<p> This is a specification of flow_chart esoteric language. </p>

<h2> a brief characteristics of the language </h2>

<p>
flow_chart is high-level, imperative (routine-based), interpreted
language, whose inputs are raster images of flow charts.
Recursion is supported as well as common data types including strings
and lists.
</p>

<h2> syntax </h2>

<p>
The source code medium of flow_chart is, unlike with most computer
languages, a raster image in PNG or BMP format. However, the image
should be, unlike with for example Piet, human readable as it represents a
flow chart. We'll suppose the image is represented as an 2D array of RGB
values, as is common, however, the language is designed to only use
black and white color in order to be easily printable on paper, though
other colors are allowed to be used (they'll just be ignored). The black
colors means [0,0,0] RGB value, the white means [255,255,255] RGB value.
</p>

<h3> blocks and connections </h3>

<p>
There exist four types ob blocks that the flow chart consists of, they
are:
</p>

<ul>
  <li>
    command - Contains a command string (&lt;CMD&gt;), there goes
    a minimum of one connection to the block and up to one connection out
    (if the command is the last command in the function, there is
    no connection going out).
  </li>
  <li>
    branching - Contains a condition string (&lt;COND&gt;), there
    goes up to one connection in and exactly two connections out
    ("then" and "else" branches).
  </li>
  <li>
    function - Contains a function definition string (&lt;FUNC&gt;),
    there goes no connection in and exactly one connection out.
  </li>
  <li>
    directive - Contains directive information string (&lt;DIR&gt;),
    such as includes, global variables or constants. There can only be
    one directive block in one program
    image and this block can have no connections, it just serves as
    program header.
  </li>
</ul>

<p>
The bloocks look like this:
</p>

<img src="images/blocks.png" alt="blocks" />

<p>
The width and height of the blocks doesn't matter, but they cannot be
empty so the theoretical minimum size depends on the size of a single
text character. The block border must always be black and one pixel
wide. The function start block must always have three-pixel wide border.
The directive border must have double border consisting of one black,
one non black and one black pixels, as in the picture.
The branching block left (right) border must be a
line that starts going one pixel left (right) and one down, then at
some point it must change to going one pixel right (left) and one down,
before it connects to the bottom border line of the block. Therefore
other possible valid blocks can look like this:
<p>

<img src="images/blocks2.png" alt="other possible blocks" />

<p>
The following examples are wrong:
</p>

<img src="images/blocks_bad.png" alt="other possible blocks" />

<p>
A block must always contain a non-empty string. The string can be
placed anywhere inside the block, it can even touch the border, but it
must not overlap it. The text must be written in black color and
it must use the font described in this document.
</p>

<p>
The blocks are connected using one-pixel wide straight (horizontal or
vertical) lines with arrows (which represent the control flow) as in
the picture:
</p>

<img src="images/lines.png" alt="lines" />

<p>
The lines can overlap in a way that's apparent from the picture - one of
the lines must have a one pixel white border around it in order to
distinguish the two lines from each other. The arrow must have exactly
the shape as in the picture, it can be pointing in each of four
directions (left, right, up, bottom).
</p>

<p>
Each line must always be connecting exactly two blocks that are
connected to the same function block (that means there can be no goto
from within one function to another). It doesn't
matter at which point the line
comes from or into a block or a line (its direction is decided by the
arrow) with the exception of branching block, where the input and "then"
lines must come either to/from the top border or to/from bottom border
and the "else" line must come from the tip of either left or right
border line. The followinf picture shows some valid block connections:
</p>

<img src="images/connections.png" alt="possible connections" />

<p>
The folowing examples are wrong:
</p>

<img src="images/connections_bad.png" alt="possible connections" />

<h3> comments </h3>

<p>
Comments can be writen (or drawn) anywhere as long as they are other
color than black and they do not interfere with the code. The reason
for this is that the interpreter only recognises black and non-black
pixels.
</p>

<h3> font </h3>

<p>
The language uses its own fixed size extended ASCII font to represent text
elements. The character size is 7&nbsp;&#215;&nbsp;8 pixels and there is exactly one
pixel space between the characters. The font characters look like this
(starting from top left, going to bottom right with 1 pixel space between
rows and columns)
</p>

<img src="images/font.png" alt="font" />

<p>
Language interpreters may include the possibility to provide custom
font maps but the program is then formally not in pure flow_chart which
only supports the font given above.
</p>

<h3> text syntax </h3>

<p>
The language is case-sensitive. The following grammar describes the
syntax (and only syntax, not expression evaluation order etc.) of the
language text elements:
</p>

<table>
  <tr> <td> &lt;CMD&gt; </td>      <td> &#10141; </td>   <td> &lt;ASSIGN&gt; | &lt;CALL&gt; | return &lt;EXP&gt; </td> </tr>
  <tr> <td> &lt;ASSIGN&gt; </td>   <td> &#10141; </td>   <td> &lt;VAR&gt; &#8592; &lt;EXP&gt; | &lt;INIT&gt; </td> </tr>
  <tr> <td> &lt;INIT&gt; </td>     <td> &#10141; </td>   <td> list </td> </tr>
  <tr> <td> &lt;VAR&gt; </td>      <td> &#10141; </td>   <td> &lt;IDENTIFIER&gt; | &lt;IDENTIFIER&gt; [ &lt;EXP&gt; ] </td> </tr>
  <tr> <td> &lt;EXP&gt; </td>      <td> &#10141; </td>   <td> ( &lt;EXP&gt; ) | &lt;VAR&gt; | &lt;CALL&gt; | &lt;CONST&gt; | &lt;EXP&gt; &lt;OP&gt; &lt;EXP&gt; </td> </tr>
  <tr> <td> &lt;OP&gt; </td>       <td> &#10141; </td>   <td> + | - | &#247; | / | * | &#215; | % | <img src="images/mod.png" /> | &#172; </td> </tr>
  <tr> <td> &lt;CONST&gt; </td>    <td> &#10141; </td>   <td> &lt;INT&gt; | &lt;FLOAT&gt; | &lt;STRING&gt; | &lt;BOOL&gt; </td> </tr>
  <tr> <td> &lt;COND&gt; </td>     <td> &#10141; </td>   <td> &lt;EXP&gt; &lt;CMP&gt; &lt;EXP&gt; </td> </tr>
  <tr> <td> &lt;CMP&gt; </td>      <td> &#10141; </td>   <td> = | &ne; | "&lt;" | "&gt;" | &ge; | &le; </td> </tr>
  <tr> <td> &lt;CALL&gt; </td>     <td> &#10141; </td>   <td> &lt;IDENTIFIER&gt; ( &lt;PARAMS&gt; ) </td> </tr>
  <tr> <td> &lt;FUNC&gt; </td>     <td> &#10141; </td>   <td> &lt;IDENTIFIER&gt; ( &lt;PARAM_LIST&gt; ) </td> </tr>
  <tr> <td> &lt;DIR&gt; </td>      <td> &#10141; </td>   <td> uses &lt;PATH&gt; | &lt;IDENTIFIER&gt; = &lt;CONST&gt; | &lt;IDENTIFIER&gt; &#8592; &lt;CONST&gt; </td> </tr>
</table>

<p>
Some of the above nonterminals are described by regexps:
</p>

<table>
  <tr> <td> &lt;IDENTIFIER&gt; </td> <td> := </td>   <td> ([a-Z] | "_") (([a-Z] | [0-9] | "_")*) </td> </tr>
  <tr> <td> &lt;FLOAT&gt; </td>      <td> := </td>   <td>  </td> </tr>
  <tr> <td> &lt;BOOL&gt; </td>       <td> := </td>   <td> "true" | "false" </td> </tr>
  <tr> <td> &lt;STRING&gt; </td>     <td> := </td>   <td> \" () \" </td> </tr>
</table>

<p>
The language keywords (that of course can't be used as identifiers) are
shown in the following list:
</p>

<ul>
  <li> false </li>
  <li> list </li>
  <li> main </li>
  <li> return </li>
  <li> true </li>
</ul>

<h2> semantics </h2>

<h3> data types </h3>

<p>
There are four atomic and one composite data types in flow_chart. These
are:
</p>

<ul>
  <li>
    int - Holds at least 16-bit signed integer value.
  </li>

  <li>
    float - Floating point number in at least single precision.
  </li>

  <li>
    string - String of ASCII characters.
  </li>

  <li>
    bool - Holds exactly one of two values: true or false.
  </li>

  <li>
    list - List is the only composite data type. It serves as dynamic
    heterogenous array of values or other lists. It's behavior is
    similar to lists in Python. The indexing uses int values. Negative
    values can be used for indexing, but they behave differently than
    in Python, i.e. index -1 doesn't address the last position in the
    list but rather an unique position "-1".
  </li>

</ul>

<h3> variables </h3>

<p>
flow_chart is dynamic-typed, that means that variables can change type
during runtime. A new variable is created when it is first assigned to,
using "&#8592;" symbol.
</p>

<p>
There can be global variables, see section
<a href="#global_directives">global directives</a>.
</p>

<p>
A function has only access to its variables (variables declared inside
itself) and global variables. If there is a global variable of some
name, there cannot be any local variable with that name anywhere else
in the program, as it cannot be created, because this is done by
assignement which in this case just causes assignment to already
existing global variable.
</p>

<h3 id="global_directives"> global directives </h3>

<p>
Global variables can be declared in directive block. To declare a
global variable it must also be initialised with a value, using
"&#8592;" symbol.
</p>

<p>
Besides global variables, global constants can be declared as well.
Constants can only be read, any attempt to write to a global constant
must result in compile-time error. In order to declare a global constant
a value must be linked to it, using "=" symbol.
</p>

<h3> expressions </h3>

<p>
Operator priority is as follows:
</p>

<table class="normal_table">
  <tr> <th> priority </th> <th> operators </th> </tr>
  <tr> <td> 1 (highest) </td> <td> ( ) [] </td> </tr>
  <tr> <td> 2 </td> <td> &#172; </td> </tr>
  <tr> <td> 3 </td> <td> &#215; &#247; </td> </tr>
  <tr> <td> 4 </td> <td> <img src="images/mod.png" /> </td> </tr>
  <tr> <td> 5 </td> <td> + - </td> </tr>
</table>

<p>
The operator semantics is as follows:
</p>

<table class="normal_table">
  <tr> <th> operator(s) </th>                                         <th> operand types </th>  <th> result type </th>  <th> description </th>    </tr>
  <tr> <td rowspan="4"> a + b, a - b, a &#215; b, a &#247; b  </td>   <td> int int       </td>  <td> int </td>          <td rowspan="4"> addition, substraction, multiplication and floating point division </td> </tr>
  <tr>                                                                <td> float float   </td>  <td> float </td>                                  </tr>
  <tr>                                                                <td> int float     </td>  <td> float </td>                                  </tr>
  <tr>                                                                <td> float int     </td>  <td> float </td>                                  </tr>
  <tr> <td rowspan="4"> a &lt; b, a &gt; b, a &le; b, a &ge; b  </td> <td> int int       </td>  <td> bool </td>         <td rowspan="4"> less than, greater than, less or equal to, greater or equal to </td> </tr>
  <tr>                                                                <td> float float   </td>  <td> bool </td>                                   </tr>
  <tr>                                                                <td> int float     </td>  <td> bool </td>                                   </tr>
  <tr>                                                                <td> float int     </td>  <td> bool </td>                                   </tr>
  <tr> <td> &#172; a </td>            <td> bool          </td>  <td> bool </td>    <td> logical negation (false to true and true to false) </td> </tr>


</table>

<h3> functions </h3>

<p>
Recursion, even indirect, is allowed. Parameters of atomic data types
(int, float,
string and bool) are passed by value, lists are passed by reference.
The function can return any atomic data type, lists can't be returned.
</p>

<p>
Function parameters behave just as if they were variables created at the
beginning of the function.
</p>

<h3> built-in functions </h3>

<ul>
  <li> print(what) - </li>
  <li> open_file(filename): int - Opens file named <i>filename</i> (it must be string, otherwise nothing happens) and returns its positive integer handle, in case of error -1 is returned. </li>
  <li> close_file(handle) - Close file with given handle, if <i>handle</i> isn't of int type or it is negative or it is not asociated with any file, nothing happens. </li>


  <li> read(file_handle) - </li>
  <li> read() - </li>
  <li> read_string(): string - </li>
  <li> read_int(): string - </li>
  <li> read_float(): string - </li>
  <li> wait(milliseconds) - </li>
  <li> type(what): string - </li>
  <li> length(what): int - Returns length of given <i>what</i> list or -1 if <i>what</i> is not a list. </li>
</ul>

<h3> standard libraries </h3>

<h2> examples </h2>

<ul>

<li>
<p> simple hello world: </p>
<img src="images/program1.png" alt="program 1" />
</li>

<li>
<p> hello world using global variables, functions and constants: </p>
<img src="images/program2.png" alt="program 2" />
</li>

</ul>

</body>

</html>
